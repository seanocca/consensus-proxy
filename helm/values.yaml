## Deploy all resources into this namespace.
## If set, overrides the release namespace for all resources.
## Set namespace.create to true to have the chart create the namespace.
namespace:
  name: ""
  create: false
  annotations: {}
  labels: {}

## Override the chart name or fullname.
nameOverride: ""
fullnameOverride: ""

## Labels to add to all deployed objects.
commonLabels: {}

## Annotations to add to all deployed objects.
commonAnnotations: {}

# -- Deployment
deployment:
  enabled: true
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0
      maxSurge: 1
  annotations: {}
  labels: {}

image:
  repository: ghcr.io/seanocca/consensus-proxy
  tag: ""  # Defaults to appVersion
  pullPolicy: IfNotPresent

imagePullSecrets: []

# -- Pod-level configuration
podAnnotations: {}
podLabels: {}

podSecurityContext: {}
  # fsGroup: 1000
  # runAsNonRoot: true

securityContext: {}
  # allowPrivilegeEscalation: false
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000
  # capabilities:
  #   drop:
  #     - ALL

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: "1"
    memory: 1Gi

nodeSelector: {}
tolerations: []
affinity: {}
topologySpreadConstraints: []

# -- Additional environment variables
extraEnv: []
# - name: EXAMPLE
#   value: "value"

# -- Additional volume mounts for the consensus-proxy container
extraVolumeMounts: []

# -- Additional volumes for the pod
extraVolumes: []

# -- Additional containers (e.g. sidecars)
extraContainers: []
# - name: my-sidecar
#   image: busybox:latest
#   command: ["sh", "-c", "while true; do echo sidecar; sleep 60; done"]

# -- Init containers
initContainers: []
# - name: init-config
#   image: busybox:latest
#   command: ["sh", "-c", "echo initializing"]

# -- Service Account
serviceAccount:
  enabled: true
  create: true
  name: ""
  annotations: {}
  labels: {}
  automountServiceAccountToken: false

# -- Service
service:
  enabled: true
  type: ClusterIP
  port: 8080
  annotations: {}
  labels: {}

# -- ConfigMap
## To use a pre-existing ConfigMap instead of the one created by this chart,
## set configMap.enabled to false and provide the name in configMap.existingConfigMap.
## The existing ConfigMap must contain a `config.toml` key.
configMap:
  enabled: true
  existingConfigMap: ""
  annotations: {}
  labels: {}
  ## The TOML configuration for consensus-proxy.
  ## Ref: https://github.com/zircuit-labs/consensus-proxy
  config: |
    [server]
    port = 8080
    read_timeout = "30s"
    write_timeout = "30s"
    max_retries = 3
    request_timeout = "30s"
    idle_timeout = "90s"
    read_header_timeout = "10s"

    [beacons]
    nodes = ["beacon1"]

    [beacons.beacon1]
    url = "http://localhost:5052"
    type = "lighthouse"

    [failover]
    error_threshold = 5

    [metrics]
    enabled = false
    statsd_addr = "localhost:8125"
    namespace = "consensus_proxy"

    [logger]
    level = "info"
    format = "json"
    output = "stdout"

    [ratelimit]
    enabled = false
    requests_per_second = 100
    window = "1m"
    cleanup_interval = "5m"
    client_expiry = "10m"

    [dns]
    cache_ttl = "5m"
    connection_timeout = "10s"

    [proxy]
    user_agent = "consensus-proxy/1.0"
    max_idle_connections = 100
    idle_connection_timeout = "90s"
    max_idle_connections_per_host = 10
    max_connections_per_host = 100
    response_header_timeout = "10s"
    tls_handshake_timeout = "10s"
    expect_continue_timeout = "1s"

    [websocket]
    read_buffer_size = 4096
    write_buffer_size = 4096
    error_channel_buffer = 100

    [health]
    interval = "30s"
    timeout = "5s"
    successful_checks_for_failback = 3

# -- Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  annotations: {}
  labels: {}
  minAvailable: 1
  # maxUnavailable: 1

# -- Probes
livenessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

readinessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

# -- Prometheus ServiceMonitor (requires prometheus-operator CRDs)
serviceMonitor:
  enabled: false
  annotations: {}
  labels: {}
  interval: 30s
  scrapeTimeout: 10s
  path: /metrics
